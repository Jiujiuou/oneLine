# 连线游戏 (One Line) 规则文档

## 1. 游戏概述
这是一个基于**哈密顿路径 (Hamiltonian Path)** 理论的益智连线闯关游戏。玩家需要在一个 $N \times N$ 的网格中，通过画线连接所有**有效格子**，且每个格子只能经过一次。

## 2. 核心机制

### 2.1 棋盘与移动规则
1.  **网格生成**：
    *   支持 $3\times3$, $4\times4$, $5\times5$ 规格。
    *   **障碍物机制**：部分关卡中会生成“石块”（不可连接区域）。
2.  **移动方向**：
    *   **标准模式**：仅支持**上、下、左、右**四个正交方向。
    *   **地狱模式**：开启**斜向 (Diagonal)** 支持（上、下、左、右、左上、左下、右上、右下）。
        *   *限制*：路径线段不可交叉（即遵循平面图规则）。
3.  **路径计算**：
    *   系统在排除障碍物后的剩余网格中，根据当前模式允许的方向生成一条哈密顿路径。

### 2.2 闯关难度阶梯 (Difficulty Progression)
游戏采用线性闯关模式，通过网格尺寸的变化平滑提升难度：

| 难度等级 | 关卡范围 | 网格尺寸 | 障碍物 | 隐藏率 | 特点 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **入门** | Lv. 1-10 | **3x3** | 无 | Low | 教学关，熟悉规则。 |
| **初级** | Lv. 11-20 | **3x4** | 无 | Low-Mid | **过渡关卡**，引入非正方概念。 |
| **中级** | Lv. 21-30 | **4x4** | 无 | Mid | 逻辑推理，标准难度。 |
| **进阶** | Lv. 31-40 | **4x5** | 无 | Mid-High | **过渡关卡**，空间变大。 |
| **高级** | Lv. 41-50 | **5x5** | 无 | High | 空间规划挑战。 |
| **大师** | Lv. 51+ | **5x5** | **有** | High | 绕路与拓扑陷阱。 |
| **地狱** | Special | **5x5** | **有** | Extreme | 开启斜向 (Diagonal) 移动。 |

### 2.3 数字隐藏 (Puzzle Generation)
*   随机隐藏部分数字，保留部分作为**提示 (Hint)**。
*   隐藏策略完全随机。

## 3. 游戏玩法

### 3.1 连线交互 (One-Shot Drawing)
*   **一气呵成**：
    *   **按下鼠标 (MouseDown)**：开始绘制新路径。**之前的路径（如有）会被立即清空**。
    *   **拖动 (Drag)**：延伸路径。
    *   **松开鼠标 (MouseUp)**：绘制结束。无论是否成功，路径锁定。再次点击将重新开始。
*   **起点规则**：
    *   如果有提示数字 `1`，必须从 `1` 开始。
    *   如果没有，点击任意位置即为起点。

### 3.2 回撤 (Backtracking)
*   **原路返回**：鼠标回到路径的上一步位置（栈顶元素的前一个），则撤销最后一步。
*   **不可跳跃**：必须物理路径上回退。

### 3.3 胜利条件
同时满足：
1.  **填满**：所有**有效格子**（不含障碍物）都被连接。
2.  **顺序正确**：所有**提示格子**的数字与玩家连接的步数一致。

## 4. 视觉与反馈状态

### 4.1 格子样式定义

| 格子类型 | 状态 | 背景色 | 文字/内容 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **普通格子** | 未连接 | ⚪️ 白色 | 无 | |
| **普通格子** | 已连接 | 🟢 绿色 | 当前步数 | |
| **提示格子** | 未连接 | 🔵 蓝色 | 预设数字 | 字体白色 |
| **提示格子** | 已连接 (正确) | 🔵 蓝色 | 预设数字 | **保持蓝色**，强调它是题面 |
| **提示格子** | 已连接 (错误) | 🔴 红色 | 预设数字 | 顺序不匹配时 |
| **障碍物** | - | ⚫️ 灰色/黑色 | 🚫 | 不可交互 |

### 4.2 视觉层级
*   障碍物 > 错误状态 > 提示状态 > 普通状态。
