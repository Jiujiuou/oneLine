# 开发计划与验收标准 (Development Plan & Acceptance Criteria)

## 阶段 1: 基础架构修复 (Infrastructure Fix)

**目标**: 补全项目当前缺失的底层依赖，使现有的 UI 组件库能够正常运行，消除控制台报错。

### 开发内容

1.  **Constants**: 创建 `src/constants/index.js`，定义 `MESSAGE_TYPES`, `THEME_TYPES`。
2.  **Store**: 创建 `src/store/index.js`，实现 `useThemeStore` (主题) 和 `useMessageStore` (全局提示)。
3.  **Hooks**: 创建 `src/hooks/index.js`，实现 `useOutsideClick`, `useTipsPosition` 等 UI 交互钩子。
4.  **Utils**: 创建 `src/utils/index.js`，实现 `copyToClipboard`。
5.  **App 入口**: 在 `App.jsx` 中挂载必要的全局 Provider (如有)。

### ✅ 验收标准

1.  运行 `npm run dev`，浏览器控制台**无任何红色报错**。
2.  **功能测试**:
    - 点击 Header 上的主题切换按钮 (Switch)，界面能正常切换黑/白模式。
    - 调用 `DropdownSelect` 组件不会报错。
    - 触发任何操作时，Message 提示条能正常弹出。

---

## 阶段 2: 核心算法实现 (Core Algorithm)

**目标**: 实现哈密顿路径生成算法和谜题生成逻辑，这是游戏的“大脑”。

### 开发内容

1.  **路径生成器**: `src/utils/hamiltonian.js`。
    - 输入：网格尺寸 ($N$), 障碍物坐标, 允许方向 (正交/斜向)。
    - 输出：一条合法的路径坐标数组。
2.  **谜题生成器**: `src/utils/puzzleGenerator.js`。
    - 功能：基于路径，根据难度参数（隐藏率）生成“提示数字”。
3.  **测试脚本**: 编写一个临时的测试文件，用于在控制台验证算法。

### ✅ 验收标准

1.  **单元测试/控制台验证**:
    - 输入 $3\times3$ 网格，能输出长度为 9 的有效路径。
    - 输入含障碍物的 $4\times4$ 网格，生成的路径能避开障碍物且填满其余格子。
    - **边界测试**: 确保没有死循环，生成速度在毫秒级。

---

## 阶段 3: 可视化棋盘与交互 (Board & Interaction)

**目标**: 实现游戏的“躯干”，让玩家能画出线来。

### 开发内容

1.  **组件开发**:
    - `GridBoard`: 渲染 $N \times N$ 网格。
    - `Cell`: 格子组件，处理不同状态（普通、提示、错误、障碍）的样式。
2.  **交互逻辑**:
    - 实现 `MouseDown` (开始), `MouseEnter` (移动/回撤), `MouseUp` (结束) 事件流。
    - 实现“回撤”判定逻辑（只能回退到上一步）。
    - 实现“路径高亮”样式。

### ✅ 验收标准

1.  **视觉验证**: 界面显示出网格。
2.  **交互验证**:
    - 鼠标按下拖拽，格子依次变绿。
    - 无法跳跃连接（只能连相邻格）。
    - 遇到障碍物无法通过。
    - **回撤测试**: 往回拖动鼠标，路径能正确缩短。
    - 松开鼠标，路径状态锁定（或重置，取决于具体实现阶段）。

---

## 阶段 4: 游戏循环与关卡系统 (Game Loop & Level System)

**目标**: 将“大脑”和“躯干”结合，形成完整的游戏体验。

### 开发内容

1.  **状态管理集成**: 使用 Store 管理当前关卡、当前路径、游戏状态（进行中/胜利）。
2.  **胜利判定**:
    - 检查路径长度是否达标。
    - 检查提示数字顺序是否匹配。
3.  **关卡流程**:
    - 定义难度阶段的配置表 (Level Config)。
    - **支持非正方形网格**：配置表需包含 `rows` 和 `cols` 字段（如 3x4, 4x5）。
    - 实现“下一关”切换逻辑。
4.  **UI 完善**: 添加“当前关卡显示”、“重置按钮”、“胜利结算弹窗”。

### ✅ 验收标准

1.  **完整流程测试**:
    - 进入游戏 -> 连线 -> 成功 -> 弹出胜利提示 -> 点击下一关 -> 加载新地图。
2.  **规则验证**:
    - 未连满所有格子 -> 不算赢。
    - 连满但顺序不对 -> 不算赢，错误格子变红。
    - 连满且顺序正确 -> 判定胜利。

---

## 阶段 5: 后续优化与打磨 (Optimization & Polish)

**目标**: 提升游戏质量，优化算法生成的谜题体验。

### 待开发内容

1.  **谜题生成算法优化**:
    - **避免连续数字聚集**: 确保生成的提示数字中，连续的数字（如 1,2,3,4）不要在物理网格上紧邻显示，避免给玩家提供过多显而易见的局部线索。
    - **优化逻辑**: 在 `src/utils/puzzleGenerator.js` 中添加后处理检查或约束条件。
2.  **地狱模式 (Lv. 50+)**:
    - 实现斜向移动算法。
    - 生成障碍物关卡。
