# 后续开发计划 (Next Development Plan)

## 📊 当前项目状态评估

### ✅ 已完成功能

1. **基础架构** ✅
   - Store状态管理（gameStore, messageStore, themeStore, soundStore）
   - Hooks工具函数
   - Utils工具函数

2. **核心算法** ✅
   - 哈密顿路径生成算法（`hamiltonian.js`）
   - 谜题生成器（`puzzleGenerator.js`）
   - 支持障碍物参数（代码层面）

3. **游戏棋盘与交互** ✅
   - GridBoard组件完整实现
   - 鼠标拖拽连线
   - 回撤功能
   - 错误提示（起点错误、顺序错误）
   - 障碍物渲染支持
   - SVG连线绘制

4. **游戏循环** ✅
   - 胜利判定逻辑
   - 关卡切换基础功能
   - 游戏状态管理（IDLE, PLAYING, WON）

5. **UI组件** ✅
   - Header（音效选择）
   - Control（关卡显示、下一关按钮）
   - Message（全局消息提示）
   - 主题切换支持

### ⚠️ 需要完善的功能

1. **关卡系统不完整**
   - `levelConfig.js` 中 `levelCount = 3`，实际只有3个关卡
   - 需要扩展到50+关卡，按照规则文档的难度阶梯

2. **障碍物功能未实现**
   - 代码已支持障碍物，但 `levelConfig.js` 中所有关卡 `obstacles: 0`
   - 需要实现障碍物生成算法（Lv. 51+）

3. **斜向移动未实现**
   - `hamiltonian.js` 只支持正交方向（上下左右）
   - 需要支持斜向移动（地狱模式）

4. **UI功能缺失**
   - 没有胜利弹窗（只有Message提示）
   - 没有重置按钮
   - 没有关卡跳转UI（有方法但无入口）

5. **谜题质量优化**
   - 未实现"避免连续数字聚集"的优化
   - 隐藏策略完全随机，可能生成过于简单的谜题

---

## 🎯 后续开发计划

### 阶段 1: 完善关卡系统 (优先级: 🔴 高)

**目标**: 扩展关卡配置，实现完整的50+关卡系统

#### 任务清单

1. **扩展关卡配置**
   - [ ] 修改 `levelConfig.js`，实现完整的关卡配置：
     - Lv. 1-10: 3x3，隐藏率 50%-60%
     - Lv. 11-20: 3x4，隐藏率 55%-65%
     - Lv. 21-30: 4x4，隐藏率 60%-70%
     - Lv. 31-40: 4x5，隐藏率 65%-75%
     - Lv. 41-50: 5x5，隐藏率 70%-80%
     - Lv. 51+: 5x5 + 障碍物，隐藏率 75%-85%

2. **测试关卡生成**
   - [ ] 验证每个难度段的关卡能正常生成
   - [ ] 确保关卡切换流畅

**预计工作量**: 2-3小时

---

### 阶段 2: 实现障碍物生成 (优先级: 🔴 高)

**目标**: 为Lv. 51+关卡生成合理的障碍物

#### 任务清单

1. **障碍物生成算法**
   - [ ] 在 `puzzleGenerator.js` 或新建 `obstacleGenerator.js` 实现障碍物生成
   - [ ] 障碍物生成策略：
     - 确保生成后仍存在哈密顿路径
     - 障碍物数量随关卡递增（Lv. 51: 1-2个，Lv. 60+: 3-4个）
     - 避免障碍物完全阻断路径

2. **集成到关卡生成**
   - [ ] 修改 `gameStore.js` 的 `_generateGameByLevel`，根据关卡配置生成障碍物
   - [ ] 障碍物生成后，重新生成哈密顿路径

3. **测试验证**
   - [ ] 测试障碍物关卡生成成功率
   - [ ] 验证障碍物渲染正确
   - [ ] 验证路径生成算法能正确处理障碍物

**预计工作量**: 4-6小时

---

### 阶段 3: UI功能完善 (优先级: 🟡 中)

**目标**: 完善游戏UI，提升用户体验

#### 任务清单

1. **胜利弹窗组件**
   - [ ] 创建 `VictoryDialog` 组件
   - [ ] 显示关卡完成信息
   - [ ] 提供"下一关"和"重玩"按钮
   - [ ] 集成到 `Layout` 或 `Control` 组件

2. **重置按钮**
   - [ ] 在 `Control` 组件添加"重置"按钮
   - [ ] 调用 `gameStore.resetGame()` 方法
   - [ ] 添加确认提示（可选）

3. **关卡跳转功能**（可选）
   - [ ] 在 `Control` 组件添加关卡选择器
   - [ ] 使用 `InputDialog` 组件让用户输入关卡号
   - [ ] 调用 `gameStore.jumpToLevel()` 方法

**预计工作量**: 3-4小时

---

### 阶段 4: 实现斜向移动（地狱模式）(优先级: 🟡 中)

**目标**: 支持斜向移动，实现地狱模式

#### 任务清单

1. **扩展方向定义**
   - [ ] 修改 `hamiltonian.js`，添加斜向方向：
     ```javascript
     // 正交方向 + 斜向方向
     const DIAGONAL_DIRECTIONS = [
       { r: -1, c: -1 }, // 左上
       { r: -1, c: 1 },  // 右上
       { r: 1, c: -1 },  // 左下
       { r: 1, c: 1 },   // 右下
     ];
     ```

2. **模式参数化**
   - [ ] 在 `generateHamiltonianPath` 添加 `allowDiagonal` 参数
   - [ ] 根据参数决定使用哪些方向
   - [ ] 更新 `gameStore` 支持模式配置

3. **GridBoard交互更新**
   - [ ] 修改 `handleMouseEnter` 中的邻居检查逻辑
   - [ ] 支持斜向相邻格子的连接

4. **关卡配置**
   - [ ] 在 `levelConfig.js` 添加"地狱模式"配置
   - [ ] 可以设置为特殊关卡或模式切换

**预计工作量**: 4-5小时

---

### 阶段 5: 谜题质量优化 (优先级: 🟢 低)

**目标**: 优化谜题生成，避免连续数字聚集

#### 任务清单

1. **实现连续数字检测**
   - [ ] 在 `puzzleGenerator.js` 添加后处理函数
   - [ ] 检测提示数字中是否有连续数字在物理网格上紧邻
   - [ ] 如果检测到，调整隐藏策略

2. **优化隐藏策略**
   - [ ] 优先隐藏连续数字中的部分数字
   - [ ] 确保至少保留一个连续序列的端点
   - [ ] 保持隐藏率在目标范围内

3. **测试验证**
   - [ ] 生成多个谜题，验证连续数字聚集情况
   - [ ] 确保优化后谜题难度合理

**预计工作量**: 3-4小时

---

### 阶段 6: 性能优化与打磨 (优先级: 🟢 低)

**目标**: 优化性能，提升用户体验

#### 任务清单

1. **算法性能优化**
   - [ ] 优化哈密顿路径生成算法（如果发现性能瓶颈）
   - [ ] 添加生成超时保护
   - [ ] 优化大网格（5x5）的生成速度

2. **UI优化**
   - [ ] 添加加载状态（生成关卡时）
   - [ ] 优化动画效果
   - [ ] 响应式布局优化

3. **错误处理**
   - [ ] 完善错误提示
   - [ ] 处理生成失败的情况
   - [ ] 添加重试机制

**预计工作量**: 2-3小时

---

## 📋 开发优先级建议

### 立即开始（核心功能）
1. ✅ **阶段1: 完善关卡系统** - 让游戏有完整的50+关卡
2. ✅ **阶段2: 实现障碍物生成** - 实现Lv. 51+的核心特性

### 后续完善（用户体验）
3. ✅ **阶段3: UI功能完善** - 提升用户体验
4. ✅ **阶段4: 实现斜向移动** - 实现地狱模式

### 可选优化（锦上添花）
5. ✅ **阶段5: 谜题质量优化** - 提升谜题质量
6. ✅ **阶段6: 性能优化与打磨** - 优化细节

---

## 🎮 验收标准

### 阶段1验收
- [ ] 能够生成Lv. 1-50的关卡
- [ ] 每个难度段的配置正确
- [ ] 关卡切换流畅无错误

### 阶段2验收
- [ ] Lv. 51+关卡能生成障碍物
- [ ] 障碍物不影响路径生成
- [ ] 障碍物正确渲染

### 阶段3验收
- [ ] 胜利时弹出胜利弹窗
- [ ] 重置按钮能清空当前路径
- [ ] UI交互流畅

### 阶段4验收
- [ ] 斜向移动模式能正常生成路径
- [ ] 玩家可以斜向连线
- [ ] 路径验证正确

### 阶段5验收
- [ ] 生成的谜题中连续数字聚集明显减少
- [ ] 谜题难度保持合理

### 阶段6验收
- [ ] 关卡生成速度在可接受范围内
- [ ] UI响应流畅
- [ ] 错误处理完善

---

## 📝 注意事项

1. **向后兼容**: 确保新功能不影响现有功能
2. **代码质量**: 保持代码整洁，添加必要注释
3. **测试**: 每个阶段完成后进行充分测试
4. **文档**: 更新相关文档（如有需要）

---

## 🚀 开始开发

建议按照优先级顺序，逐步完成各个阶段。每个阶段完成后，进行一次完整的游戏测试，确保功能正常。

